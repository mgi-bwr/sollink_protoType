<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œëª¨í’ˆ ê´€ë¦¬ - SOLink ë¡œë´‡ í†µí•© ê´€ì œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        /* ì‚¬ì´ë“œë°” ìŠ¤í¬ë¡¤ */
        .sidebar-scroll {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #4A4D55 #2B2D33;
        }
        
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-track {
            background: #2B2D33;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #4A4D55;
            border-radius: 3px;
        }

        /* ë©”ë‰´ í˜¸ë²„ íš¨ê³¼ */
        .menu-item:hover {
            background-color: #35373D;
        }

        /* ìƒíƒœ ë°°ì§€ ì• ë‹ˆë©”ì´ì…˜ */
        .status-badge {
            transition: all 0.2s ease;
        }

        /* í† ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast {
            animation: slideIn 0.3s ease-out;
        }

        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-overlay {
            animation: fadeIn 0.2s ease-out;
        }

        /* í…Œì´ë¸” í–‰ í˜¸ë²„ */
        .table-row:hover {
            background-color: #F8F9FA;
        }

        /* ê²€ìƒ‰ ì•„ì´ì½˜ */
        .search-icon {
            pointer-events: none;
        }

        /* ì´ë ¥ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .history-row {
            transition: background-color 0.2s;
        }

        .history-row:hover {
            background-color: #F8F9FA;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ -->
    <div class="flex min-h-screen">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="w-[200px] bg-[#2B2D33] text-white flex flex-col fixed h-screen">
            <!-- ë¡œê³  -->
            <div class="h-[70px] bg-[#00C896] flex items-center justify-center cursor-pointer">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white rounded flex items-center justify-center">
                        <span class="text-[#00C896] font-bold text-xl">S</span>
                    </div>
                    <span class="text-white font-bold text-lg">SOLink</span>
                </div>
            </div>

            <!-- ë©”ë‰´ ì˜ì—­ -->
            <nav class="flex-1 sidebar-scroll py-4">
                <div class="px-3 space-y-1">
                    <!-- ë©”ë‰´ ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ“‹</span>
                            <span>ë§¤ë‰´ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ê¶Œí•œ ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ”</span>
                            <span>ê¶Œí•œ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ë°ì´í„° ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ“Š</span>
                            <span>ë°ì´í„° ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ì‚¬ì´íŠ¸ ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ¢</span>
                            <span>ì‚¬ì´íŠ¸ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ì§€ë„ ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ—ºï¸</span>
                            <span>ì§€ë„ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- íšŒì› ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ‘¥</span>
                            <span>íšŒì› ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ë¡œë´‡ ê´€ë¦¬ - í™œì„± -->
                    <div class="bg-[#26C6DA] px-4 py-3 rounded cursor-pointer text-sm">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ¤–</span>
                            <span>ë¡œë´‡ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- POI ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ“</span>
                            <span>POI ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ì•Œë¦¼ ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ””</span>
                            <span>ì•Œë¦¼ ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- AoD ê´€ë¦¬ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ“±</span>
                            <span>AoD ê´€ë¦¬</span>
                        </div>
                    </div>

                    <!-- ë¬¸ì˜ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>â“</span>
                            <span>ë¬¸ì˜</span>
                        </div>
                    </div>

                    <!-- ë„ì›€ë§ -->
                    <div class="menu-item px-4 py-3 rounded cursor-pointer flex items-center justify-between text-sm text-[#A0A3A8]">
                        <div class="flex items-center space-x-3">
                            <span>ğŸ“–</span>
                            <span>ë„ì›€ë§</span>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ & ë²„ì „ ì •ë³´ -->
            <div class="p-4 space-y-2">
                <button class="w-full bg-[#26C6DA] hover:bg-[#21B1C4] text-white py-3 rounded font-medium transition-colors">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
                <div class="text-center text-xs text-[#6C757D]">
                    Version 3.0<br>
                    Â© Bigwave Robotics Inc. All Rights Reserved.
                </div>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="ml-[200px] flex-1 bg-[#F5F7FA]">
            <!-- ìƒë‹¨ í—¤ë” -->
            <header class="bg-white border-b border-gray-200 h-[70px] flex items-center justify-between px-8">
                <h1 class="text-2xl font-bold text-[#1A1C20]">ë¡œë´‡ ê´€ë¦¬ / ì†Œëª¨í’ˆ ê´€ë¦¬</h1>
                <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer">
                    <span class="text-gray-600">ğŸ‘¤</span>
                </div>
            </header>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <div class="p-8">
                <!-- í•„í„° ì„¹ì…˜ -->
                <div class="bg-white rounded-lg border border-[#E1E4E8] p-5 mb-6">
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-semibold text-[#495057] min-w-[80px]">ì‚¬ì´íŠ¸ ì„ íƒ</label>
                        <div class="flex-1 max-w-xs">
                            <select id="siteSelect" class="w-full h-10 px-4 border border-[#CED4DA] rounded focus:outline-none focus:border-[#26C6DA] text-sm">
                                <option value="all">ì‚¬ì´íŠ¸ ì „ì²´</option>
                                <option value="site-a">ì‚¬ì´íŠ¸ A</option>
                                <option value="site-b">ì‚¬ì´íŠ¸ B</option>
                                <option value="site-c">ì‚¬ì´íŠ¸ C</option>
                                <option value="site-d">ì‚¬ì´íŠ¸ D</option>
                                <option value="site-e">ì‚¬ì´íŠ¸ E</option>
                                <option value="site-f">ì‚¬ì´íŠ¸ F</option>
                                <option value="site-g">ì‚¬ì´íŠ¸ G</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì²­ì†Œë¡œë´‡ ëª©ë¡ ì¹´ë“œ -->
                <div class="bg-white rounded-lg border border-[#E1E4E8] shadow-sm">
                    <!-- ì¹´ë“œ í—¤ë” -->
                    <div class="border-b border-[#E1E4E8] p-5">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold text-[#1A1C20]">ì²­ì†Œë¡œë´‡ ëª©ë¡</h2>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="robotSearch" 
                                    placeholder="ë¡œë´‡ëª… ê²€ìƒ‰..." 
                                    class="w-64 h-10 pl-10 pr-4 border border-[#CED4DA] rounded focus:outline-none focus:border-[#26C6DA] text-sm"
                                >
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- í…Œì´ë¸” -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-[#F8F9FA]">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">No.</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ì‚¬ì´íŠ¸ëª…</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ë¡œë´‡ ëª¨ë¸ëª…</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ë¡œë´‡ëª…</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ì†Œëª¨í’ˆ ì¢…í•© ìƒíƒœ</th>
                                    <th class="px-6 py-4 text-center text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="robotTableBody">
                                <!-- Row 1 -->
                                <tr class="table-row border-b border-[#E9ECEF]">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">6</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ A</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-X Pro</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-A01</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#F8D7DA] text-[#721C24]">
                                            êµì²´ í•„ìš”
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-A01', 'Clean-X Pro', 'replace', 'ì‚¬ì´íŠ¸ A')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                                <!-- Row 2 -->
                                <tr class="table-row border-b border-[#E9ECEF]">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">5</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ A</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-X Pro</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-A02</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#FFF3CD] text-[#856404]">
                                            ì£¼ì˜
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-A02', 'Clean-X Pro', 'warning', 'ì‚¬ì´íŠ¸ A')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                                <!-- Row 3 -->
                                <tr class="table-row border-b border-[#E9ECEF]">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">4</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ B</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-Y</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-B01</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#D4EDDA] text-[#155724]">
                                            ì •ìƒ (ì¼ë¶€ ì†Œëª¨í’ˆ ì •ë³´ ë¯¸ì„¤ì •)
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-B01', 'Clean-Y', 'mixed-y', 'ì‚¬ì´íŠ¸ B')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                                <!-- Row 4 -->
                                <tr class="table-row border-b border-[#E9ECEF]">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">3</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ C</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-Z Mini</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-C02</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#FFF3CD] text-[#856404]">
                                            ì†Œëª¨í’ˆ ì •ë³´ ë¯¸ì„¤ì •
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-C02', 'Clean-Z Mini', 'unset', 'ì‚¬ì´íŠ¸ C')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                                <!-- Row 5 -->
                                <tr class="table-row border-b border-[#E9ECEF]">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">2</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ D</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-X Pro</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-D01</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#D4EDDA] text-[#155724]">
                                            ì •ìƒ (ì¼ë¶€ ì†Œëª¨í’ˆ ì •ë³´ ë¯¸ì„¤ì •)
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-D01', 'Clean-X Pro', 'mixed', 'ì‚¬ì´íŠ¸ D')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                                <!-- Row 6 -->
                                <tr class="table-row">
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">1</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì‚¬ì´íŠ¸ E</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">Clean-X Pro</td>
                                    <td class="px-6 py-4 text-sm text-[#1A1C20]">ì²­ì†Œë¡œë´‡-E01</td>
                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#FFF3CD] text-[#856404]">
                                            ì†Œëª¨í’ˆ ì •ë³´ ë¯¸ì„¤ì •
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <button onclick="openDetailPage('ì²­ì†Œë¡œë´‡-E01', 'Clean-X Pro', 'unset', 'ì‚¬ì´íŠ¸ E')" class="text-[#26C6DA] hover:text-[#21B1C4] font-medium text-sm">
                                            ìƒì„¸ ê´€ë¦¬
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ì†Œëª¨í’ˆ ìƒì„¸ ê´€ë¦¬ í˜ì´ì§€ -->
    <div id="detailPage" class="fixed inset-0 bg-[#F5F7FA] hidden">
        <!-- ì‚¬ì´ë“œë°” ì˜¤ë²„ë ˆì´ -->
        <div class="fixed left-0 top-0 bottom-0 w-[200px] bg-[#2B2D33] z-10"></div>
        
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="relative ml-[200px] bg-white border-b border-gray-200 h-[70px] flex items-center justify-between px-8 z-20">
            <div class="flex items-center space-x-4">
                <button onclick="closeDetailPage()" class="text-gray-600 hover:text-gray-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-[#1A1C20]" id="pageTitle">ë¡œë´‡ ê´€ë¦¬ / ì†Œëª¨í’ˆ ê´€ë¦¬</h1>
            </div>
            <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center cursor-pointer">
                <span class="text-gray-600">ğŸ‘¤</span>
            </div>
        </header>

        <!-- ì»¨í…ì¸  ì˜ì—­ -->
        <div class="ml-[200px] h-screen overflow-y-auto pb-24">
            <div class="p-8">
                <div class="mb-6">
                    <p class="text-sm text-[#6C757D]" id="pageSubtitle">ë¡œë´‡ëª…: ì²­ì†Œë¡œë´‡-A01 (ëª¨ë¸: Clean-X Pro)</p>
                </div>

                <!-- ì†Œëª¨í’ˆ ëª©ë¡ -->
                <div id="consumablesForm" class="space-y-6">
                    <!-- ì†Œëª¨í’ˆ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ì´ì „ìœ¼ë¡œ ë²„íŠ¼ -->
                <div class="mt-8 flex justify-end">
                    <button onclick="closeDetailPage()" class="px-6 py-2 border border-[#CED4DA] rounded text-[#6C757D] hover:bg-[#F8F9FA] font-medium">
                        ì´ì „ìœ¼ë¡œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì†Œëª¨í’ˆ ì´ë ¥ ì¡°íšŒ ëª¨ë‹¬ -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[60] modal-overlay">
        <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 h-[700px] flex flex-col">
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <div class="border-b border-[#E1E4E8] p-6 flex items-center justify-between bg-white flex-shrink-0">
                <div>
                    <h3 class="text-xl font-semibold text-[#1A1C20]" id="historyModalTitle">ì†Œëª¨í’ˆ ì´ë ¥ ì¡°íšŒ</h3>
                    <div class="mt-1 text-sm text-[#6C757D]" id="historyModalSubtitle">
                        <p>ë¡œë´‡: ì²­ì†Œë¡œë´‡-A01</p>
                        <p>ì†Œëª¨í’ˆ: ë©”ì¸ ë¸ŒëŸ¬ì‹œ</p>
                    </div>
                </div>
                <button onclick="closeHistoryModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- ëª¨ë‹¬ ë³¸ë¬¸ -->
            <div class="p-6 flex-1 overflow-y-auto">
                <!-- ì´ë ¥ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-[#F8F9FA]">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ê¸°ë¡ ì¼ì‹œ</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">êµì²´ ì¼ì</th>
                                <th class="px-4 py-3 text-right text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">ì”ëŸ‰ (%)</th>
                                <th class="px-4 py-3 text-right text-sm font-semibold text-[#495057] border-b-2 border-[#DEE2E6]">í‰ê·  ì†Œëª¨ìœ¨ (%)</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- ì´ë ¥ ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div id="paginationInfo" class="flex items-center justify-between mt-4 pt-4 border-t border-[#E1E4E8]">
                    <div class="text-sm text-[#6C757D]">
                        ì´ 0ê±´ ì¤‘ 0-0ê±´
                    </div>
                    <div id="paginationButtons" class="flex items-center space-x-2">
                        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <!-- ëª¨ë‹¬ í‘¸í„° -->
            <div class="border-t border-[#E1E4E8] p-6 flex justify-end bg-white flex-shrink-0">
                <button onclick="closeHistoryModal()" class="px-6 py-2 border border-[#CED4DA] rounded text-[#6C757D] hover:bg-[#F8F9FA] font-medium">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="fixed top-8 right-8 bg-white border border-[#E1E4E8] rounded-lg shadow-lg p-4 hidden toast z-50 min-w-[300px]">
        <div class="flex items-start">
            <div id="toastIcon" class="mr-3"></div>
            <div class="flex-1">
                <p id="toastMessage" class="text-sm font-medium text-[#1A1C20]"></p>
            </div>
            <button onclick="hideToast()" class="ml-3 text-gray-400 hover:text-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // ì†Œëª¨í’ˆ ë°ì´í„° (ëª¨ë¸ë³„ ì†Œëª¨í’ˆ ìœ í˜•)
        const consumablesByModel = {
            'Clean-X Pro': [
                { id: 1, type: 'ë©”ì¸ ë¸ŒëŸ¬ì‹œ', typeId: 'brush-main' },
                { id: 2, type: 'ì‚¬ì´ë“œ ë¸ŒëŸ¬ì‹œ', typeId: 'brush-side' },
                { id: 3, type: 'HEPA í•„í„°', typeId: 'filter-hepa' },
                { id: 4, type: 'ë¨¼ì§€í†µ í•„í„°', typeId: 'filter-dust' },
                { id: 5, type: 'ë¬¼ê±¸ë ˆ íŒ¨ë“œ', typeId: 'mop-pad' }
            ],
            'Clean-Y': [
                { id: 1, type: 'ë©”ì¸ ë¸ŒëŸ¬ì‹œ', typeId: 'brush-main' },
                { id: 2, type: 'ì‚¬ì´ë“œ ë¸ŒëŸ¬ì‹œ', typeId: 'brush-side' },
                { id: 3, type: 'í•„í„°', typeId: 'filter-standard' },
                { id: 4, type: 'ë¬¼ê±¸ë ˆ íŒ¨ë“œ', typeId: 'mop-pad' }
            ],
            'Clean-Z Mini': [
                { id: 1, type: 'ë¸ŒëŸ¬ì‹œ', typeId: 'brush-standard' },
                { id: 2, type: 'í•„í„°', typeId: 'filter-standard' }
            ]
        };

        // ì†Œëª¨í’ˆ ìƒíƒœ ìƒ˜í”Œ ë°ì´í„° (ìˆ˜ì •ëœ PRD ê¸°ì¤€: êµì²´ í•„ìš” â‰¤5%, ì£¼ì˜ â‰¤10%)
        const consumableStates = {
            'replace': {
                'brush-main': { enabled: true, lastReplaced: '2024-08-15', remaining: 3, avgConsumption: 0.0015, status: 'replace' },
                'brush-side': { enabled: true, lastReplaced: '2024-09-01', remaining: 8, avgConsumption: 0.0008, status: 'replace' },
                'filter-hepa': { enabled: true, lastReplaced: '2024-07-20', remaining: 2, avgConsumption: 0.0002, status: 'replace' },
                'filter-dust': { enabled: true, lastReplaced: '2024-10-01', remaining: 65, avgConsumption: 0.0012, status: 'normal' },
                'mop-pad': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null }
            },
            'warning': {
                'brush-main': { enabled: true, lastReplaced: '2024-09-10', remaining: 8, avgConsumption: 0.0023, status: 'warning' },
                'brush-side': { enabled: true, lastReplaced: '2024-09-15', remaining: 45, avgConsumption: 0.0015, status: 'normal' },
                'filter-hepa': { enabled: true, lastReplaced: '2024-09-20', remaining: 52, avgConsumption: 0.0028, status: 'normal' },
                'filter-dust': { enabled: true, lastReplaced: '2024-10-05', remaining: 78, avgConsumption: 0.0010, status: 'normal' },
                'mop-pad': { enabled: true, lastReplaced: '2024-10-10', remaining: 85, avgConsumption: 0.0008, status: 'normal' }
            },
            'normal': {
                'brush-main': { enabled: true, lastReplaced: '2024-10-01', remaining: 75, avgConsumption: 0.0020, status: 'normal' },
                'brush-side': { enabled: true, lastReplaced: '2024-10-01', remaining: 80, avgConsumption: 0.0015, status: 'normal' },
                'filter-hepa': { enabled: true, lastReplaced: '2024-10-05', remaining: 85, avgConsumption: 0.0025, status: 'normal' },
                'filter-dust': { enabled: true, lastReplaced: '2024-10-05', remaining: 90, avgConsumption: 0.0010, status: 'normal' },
                'mop-pad': { enabled: true, lastReplaced: '2024-10-10', remaining: 95, avgConsumption: 0.0005, status: 'normal' }
            },
            'none': {
                'brush-standard': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'filter-standard': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null }
            },
            'mixed': {
                'brush-main': { enabled: true, lastReplaced: '2024-10-01', remaining: 75, avgConsumption: 0.0020, status: 'normal' },
                'brush-side': { enabled: true, lastReplaced: '2024-10-01', remaining: 80, avgConsumption: 0.0015, status: 'normal' },
                'filter-hepa': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'filter-dust': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'mop-pad': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null }
            },
            'mixed-y': {
                'brush-main': { enabled: true, lastReplaced: '2024-10-01', remaining: 75, avgConsumption: 0.0020, status: 'normal' },
                'brush-side': { enabled: true, lastReplaced: '2024-10-01', remaining: 80, avgConsumption: 0.0015, status: 'normal' },
                'filter-standard': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'mop-pad': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null }
            },
            'unset': {
                'brush-main': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'brush-side': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'filter-hepa': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'filter-dust': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'mop-pad': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'brush-standard': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null },
                'filter-standard': { enabled: false, lastReplaced: null, remaining: null, avgConsumption: null, status: null }
            }
        };

        // ê° ì†Œëª¨í’ˆì˜ ì´ˆê¸°ê°’ ì €ì¥ (ì´ˆê¸°í™” ë²„íŠ¼ìš©)
        let initialValues = {};

        let currentRobotName = '';
        let currentModelName = '';
        let currentStateType = '';
        let currentHistoryPage = 1; // í˜„ì¬ ì´ë ¥ í˜ì´ì§€

        // ìƒì„¸ í˜ì´ì§€ ì—´ê¸°
        function openDetailPage(robotName, modelName, stateType, siteName) {
            console.log('openDetailPage called with:', robotName, modelName, stateType, siteName);
            currentRobotName = robotName;
            currentModelName = modelName;
            currentStateType = stateType;

            const subtitleEl = document.getElementById('pageSubtitle');
            if (!subtitleEl) {
                console.error('pageSubtitle element not found');
                return;
            }
            subtitleEl.innerHTML = `ë¡œë´‡: ${robotName} (ëª¨ë¸: ${modelName})<br>ì‚¬ì´íŠ¸: ${siteName}`;
            
            const consumables = consumablesByModel[modelName] || [];
            const states = consumableStates[stateType] || {};
            
            // ì†Œëª¨í’ˆ ì¢…í•© ìƒíƒœ ê³„ì‚°
            let hasReplace = false, hasWarning = false, hasNormal = false, hasUnconfigured = false, allConfigured = true;
            
            consumables.forEach(item => {
                const state = states[item.typeId] || {};
                const isConfigured = state.lastReplaced !== null && state.remaining !== null && state.avgConsumption !== null;
                
                if (state.status === 'replace') hasReplace = true;
                if (state.status === 'warning') hasWarning = true;
                if (state.status === 'normal' && isConfigured) hasNormal = true;
                if (!isConfigured) {
                    hasUnconfigured = true;
                    allConfigured = false;
                }
            });
            
            // ì¢…í•© ìƒíƒœ í…ìŠ¤íŠ¸
            let overallStatus = '';
            if (hasReplace) {
                overallStatus = '<div class="mb-6 p-4 bg-[#F8D7DA] border border-[#F5C6CB] rounded-lg"><p class="text-sm text-[#721C24] font-medium">ğŸš¨ êµì²´ê°€ í•„ìš”í•œ ì†Œëª¨í’ˆì´ ìˆìŠµë‹ˆë‹¤.</p></div>';
            } else if (hasWarning) {
                overallStatus = '<div class="mb-6 p-4 bg-[#FFF3CD] border border-[#FFE0A1] rounded-lg"><p class="text-sm text-[#856404] font-medium">âš ï¸ ì£¼ì˜ê°€ í•„ìš”í•œ ì†Œëª¨í’ˆì´ ìˆìŠµë‹ˆë‹¤.</p></div>';
            } else if (hasNormal && hasUnconfigured) {
                overallStatus = '<div class="mb-6 p-4 bg-[#D4EDDA] border border-[#C3E6CB] rounded-lg"><p class="text-sm text-[#155724] font-medium">âœ“ ëª¨ë“  ì†Œëª¨í’ˆì´ ì •ìƒì…ë‹ˆë‹¤. <span class="text-[#856404]">(ì •ë³´ë¥¼ ì„¤ì •í•´ì•¼ í•˜ëŠ” ì†Œëª¨í’ˆì´ ìˆìŠµë‹ˆë‹¤.)</span></p></div>';
            } else if (allConfigured && hasNormal && !hasUnconfigured) {
                overallStatus = '<div class="mb-6 p-4 bg-[#D4EDDA] border border-[#C3E6CB] rounded-lg"><p class="text-sm text-[#155724] font-medium">âœ“ ëª¨ë“  ì†Œëª¨í’ˆì´ ì •ìƒì…ë‹ˆë‹¤.</p></div>';
            } else {
                overallStatus = '<div class="mb-6 p-4 bg-[#FFF3CD] border border-[#FFE0A1] rounded-lg"><p class="text-sm text-[#856404] font-medium">âš ï¸ ì†Œëª¨í’ˆë³„ë¡œ ì •ë³´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p></div>';
            }
            
            const formHTML = overallStatus + consumables.map(item => {
                const state = states[item.typeId] || { enabled: true, lastReplaced: null, remaining: null, avgConsumption: null, status: null };
                
                // ì´ˆê¸°ê°’ ì €ì¥
                initialValues[item.typeId] = {
                    lastReplaced: state.lastReplaced || '',
                    remaining: state.remaining || '',
                    avgConsumption: state.avgConsumption || ''
                };
                
                // ì„¤ì • ì—¬ë¶€ íŒë‹¨
                const isConfigured = state.lastReplaced !== null && state.remaining !== null && state.avgConsumption !== null;
                
                return `
                    <div class="border border-[#E1E4E8] rounded-lg p-5">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h4 class="text-base font-semibold text-[#1A1C20]">${item.type}</h4>
                                ${!isConfigured ? `
                                    <div class="mt-2">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-[#FFF3CD] text-[#856404]">
                                            ì†Œëª¨í’ˆ ì •ë³´ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
                                        </span>
                                    </div>
                                ` : ''}
                                ${state.status ? `
                                    <div class="mt-2 flex items-center space-x-4">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(state.status)}">
                                            ${getStatusText(state.status)}
                                        </span>
                                        ${state.remaining !== null ? `<span class="text-sm text-[#6C757D]">ì”ëŸ‰: ${state.remaining}%</span>` : ''}
                                    </div>
                                    <div class="mt-2 text-xs text-[#6C757D]">
                                        ì”ëŸ‰ ë§ˆì§€ë§‰ ê°±ì‹  ì¼ì‹œ: ${getCurrentDateTime()}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div id="form-${item.typeId}">
                            <div class="flex gap-4 items-end">
                                <div class="flex-1 min-w-0">
                                    <label class="block text-sm font-medium text-[#495057] mb-2">êµì²´ ì¼ì <span class="text-red-500">*</span></label>
                                    <input 
                                        type="date" 
                                        id="lastReplaced-${item.typeId}"
                                        data-type="${item.typeId}" 
                                        data-field="lastReplaced"
                                        value="${state.lastReplaced || ''}" 
                                        onchange="handleDateChange('${item.typeId}')"
                                        class="w-full h-10 px-3 border border-[#CED4DA] rounded focus:outline-none focus:border-[#26C6DA] text-sm"
                                    >
                                </div>
                                <div class="flex-1 min-w-0">
                                    <label class="block text-sm font-medium text-[#495057] mb-2">ì”ëŸ‰ (%) <span class="text-red-500">*</span></label>
                                    <input 
                                        type="number" 
                                        step="0.1" 
                                        min="0" 
                                        max="100"
                                        id="remaining-${item.typeId}"
                                        data-type="${item.typeId}" 
                                        data-field="remaining"
                                        value="${state.remaining !== null ? state.remaining : ''}" 
                                        placeholder="ì˜ˆ: 75.5" 
                                        class="w-full h-10 px-3 border border-[#CED4DA] rounded focus:outline-none focus:border-[#26C6DA] text-sm"
                                    >
                                </div>
                                <div class="flex-1 min-w-0">
                                    <label class="block text-sm font-medium text-[#495057] mb-2">í‰ê·  ì†Œëª¨ìœ¨ (%) <span class="text-red-500">*</span></label>
                                    <input 
                                        type="number" 
                                        step="0.0001" 
                                        min="0" 
                                        max="100"
                                        id="avgConsumption-${item.typeId}"
                                        data-type="${item.typeId}" 
                                        data-field="avgConsumption"
                                        value="${state.avgConsumption !== null ? state.avgConsumption : ''}" 
                                        placeholder="ì˜ˆ: 0.0015" 
                                        class="w-full h-10 px-3 border border-[#CED4DA] rounded focus:outline-none focus:border-[#26C6DA] text-sm"
                                    >
                                </div>
                                <div class="flex items-end">
                                    <button 
                                        onclick="resetConsumable('${item.typeId}')" 
                                        class="h-10 px-3 py-2 border border-[#CED4DA] rounded text-sm text-[#6C757D] hover:bg-[#F8F9FA] whitespace-nowrap"
                                    >
                                        ì´ì „ ê°’ìœ¼ë¡œ
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-2">
                                <p class="text-xs text-[#6C757D]">
                                    â€» ìƒˆë¡œìš´ êµì²´ ì¼ìë¥¼ ì…ë ¥í•˜ë©´ ì”ëŸ‰ì´ ê¸°ë³¸ê°’ì¸ 100%ë¡œ ì ìš©ë©ë‹ˆë‹¤.
                                </p>
                            </div>
                            
                            <div class="mt-4 flex items-center justify-end space-x-3">
                                <button 
                                    onclick="openHistoryModal('${item.type}', '${item.typeId}')" 
                                    class="px-4 py-2 border border-[#CED4DA] rounded text-sm text-[#6C757D] hover:bg-[#F8F9FA]"
                                >
                                    ì´ë ¥ ì¡°íšŒ
                                </button>
                                <button 
                                    id="saveBtn-${item.typeId}"
                                    onclick="saveConsumable('${item.typeId}', '${item.type}')" 
                                    class="px-4 py-2 bg-[#26C6DA] hover:bg-[#21B1C4] text-white rounded text-sm font-medium opacity-50 cursor-not-allowed"
                                    disabled
                                >
                                    ì €ì¥í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const formEl = document.getElementById('consumablesForm');
            if (!formEl) {
                console.error('consumablesForm element not found');
                return;
            }
            formEl.innerHTML = formHTML;
            
            // ë©”ì¸ í˜ì´ì§€ ìˆ¨ê¸°ê³  ìƒì„¸ í˜ì´ì§€ í‘œì‹œ
            const mainEl = document.querySelector('main');
            const detailPageEl = document.getElementById('detailPage');
            
            if (!mainEl) {
                console.error('main element not found');
                return;
            }
            if (!detailPageEl) {
                console.error('detailPage element not found');
                return;
            }
            
            console.log('Hiding main, showing detail page');
            mainEl.classList.add('hidden');
            detailPageEl.classList.remove('hidden');
            
            // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo(0, 0);
            
            // detailPage ì»¨í…ì¸  ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            const detailContent = detailPageEl.querySelector('div.ml-\\[200px\\]');
            if (detailContent) {
                detailContent.scrollTop = 0;
            }
            
            // ëª¨ë“  ì†Œëª¨í’ˆì— ëŒ€í•´ input ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            consumables.forEach(item => {
                const typeId = item.typeId;
                const inputs = [
                    document.getElementById(`lastReplaced-${typeId}`),
                    document.getElementById(`remaining-${typeId}`),
                    document.getElementById(`avgConsumption-${typeId}`)
                ];
                
                inputs.forEach(input => {
                    if (input) {
                        input.addEventListener('input', () => checkSaveButtonState(typeId));
                    }
                });
                
                // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
                checkSaveButtonState(typeId);
            });
        }
        
        // ì €ì¥ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì²´í¬
        function checkSaveButtonState(typeId) {
            const saveBtn = document.getElementById(`saveBtn-${typeId}`);
            if (!saveBtn) return;
            
            const lastReplaced = document.getElementById(`lastReplaced-${typeId}`).value;
            const remaining = document.getElementById(`remaining-${typeId}`).value;
            const avgConsumption = document.getElementById(`avgConsumption-${typeId}`).value;
            
            // ëª¨ë“  í•„ìˆ˜ê°’ì´ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const isAllFilled = lastReplaced && remaining !== '' && avgConsumption !== '';
            
            if (isAllFilled) {
                // 'ì €ì¥ ì¤‘...' ìƒíƒœê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í™œì„±í™”
                if (saveBtn.textContent !== 'ì €ì¥ ì¤‘...') {
                    saveBtn.disabled = false;
                    saveBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    saveBtn.classList.add('hover:bg-[#21B1C4]');
                }
            } else {
                saveBtn.disabled = true;
                saveBtn.classList.add('opacity-50', 'cursor-not-allowed');
                saveBtn.classList.remove('hover:bg-[#21B1C4]');
            }
        }

        // êµì²´ ì¼ì ë³€ê²½ ì‹œ ì”ëŸ‰ 100% ìë™ ì ìš©
        function handleDateChange(typeId) {
            const dateInput = document.getElementById(`lastReplaced-${typeId}`);
            const remainingInput = document.getElementById(`remaining-${typeId}`);
            
            if (dateInput.value) {
                remainingInput.value = 100;
                // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì¬í™•ì¸
                checkSaveButtonState(typeId);
            }
        }

        // ì†Œëª¨í’ˆ ì´ˆê¸°í™”
        function resetConsumable(typeId) {
            const initial = initialValues[typeId];
            document.getElementById(`lastReplaced-${typeId}`).value = initial.lastReplaced;
            document.getElementById(`remaining-${typeId}`).value = initial.remaining;
            document.getElementById(`avgConsumption-${typeId}`).value = initial.avgConsumption;
            showToast('info', 'ì´ˆê¸°ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ìƒì„¸ í˜ì´ì§€ ë‹«ê¸°
        function closeDetailPage() {
            document.querySelector('main').classList.remove('hidden');
            document.getElementById('detailPage').classList.add('hidden');
        }

        // ê°œë³„ ì†Œëª¨í’ˆ ì €ì¥
        function saveConsumable(typeId, typeName) {
            const lastReplaced = document.getElementById(`lastReplaced-${typeId}`).value;
            const remaining = document.getElementById(`remaining-${typeId}`).value;
            const avgConsumption = document.getElementById(`avgConsumption-${typeId}`).value;

            if (!lastReplaced || remaining === '' || avgConsumption === '') {
                showToast('error', `${typeName}: êµì²´ ì¼ì, ì”ëŸ‰, í‰ê·  ì†Œëª¨ìœ¨ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.`);
                return;
            }

            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const saveBtn = document.getElementById(`saveBtn-${typeId}`);
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.classList.add('opacity-50', 'cursor-not-allowed');
                saveBtn.classList.remove('hover:bg-[#21B1C4]');
                saveBtn.textContent = 'ì €ì¥ ì¤‘...';
            }

            const data = {
                typeId: typeId,
                type: typeName,
                lastReplaced: lastReplaced,
                remaining: parseFloat(remaining),
                avgConsumption: parseFloat(avgConsumption)
            };

            console.log('ì†Œëª¨í’ˆ ì €ì¥ ë°ì´í„°:', data);
            
            // ì„œë²„ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ìŒ)
            setTimeout(() => {
                // ì´ˆê¸°ê°’ ì—…ë°ì´íŠ¸
                initialValues[typeId] = {
                    lastReplaced: lastReplaced,
                    remaining: remaining,
                    avgConsumption: avgConsumption
                };
                
                // ì†Œëª¨í’ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
                const states = consumableStates[currentStateType] || {};
                const newStatus = parseFloat(remaining) <= 5 ? 'replace' : (parseFloat(remaining) <= 10 ? 'warning' : 'normal');
                states[typeId] = {
                    enabled: true,
                    lastReplaced: lastReplaced,
                    remaining: parseFloat(remaining),
                    avgConsumption: parseFloat(avgConsumption),
                    status: newStatus
                };
                
                // UI ì—…ë°ì´íŠ¸ - í•´ë‹¹ ì†Œëª¨í’ˆ ì¹´ë“œë§Œ ì¬ë Œë”ë§
                updateConsumableCard(typeId, typeName, {
                    lastReplaced: lastReplaced,
                    remaining: remaining,
                    avgConsumption: avgConsumption,
                    status: newStatus
                });
                
                // ì €ì¥ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    saveBtn.classList.add('hover:bg-[#21B1C4]');
                    saveBtn.textContent = 'ì €ì¥í•˜ê¸°';
                }
                
                showToast('success', `${typeName} ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }, 1000);
        }
        
        // ì†Œëª¨í’ˆ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateConsumableCard(typeId, typeName, data) {
            const formContainer = document.getElementById(`form-${typeId}`).parentElement;
            
            // ìƒíƒœ í‘œì‹œ ì˜ì—­ ì°¾ê¸°
            const statusContainer = formContainer.previousElementSibling;
            if (statusContainer) {
                // ìƒíƒœ ë°°ì§€ì™€ ì”ëŸ‰ ì •ë³´ í‘œì‹œ
                const statusHTML = `
                    <div class="mt-2 flex items-center space-x-4">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(data.status)}">
                            ${getStatusText(data.status)}
                        </span>
                        <span class="text-sm text-[#6C757D]">ì”ëŸ‰: ${data.remaining}%</span>
                    </div>
                    <div class="mt-2 text-xs text-[#6C757D]">
                        ì”ëŸ‰ ë§ˆì§€ë§‰ ê°±ì‹  ì¼ì‹œ: ${getCurrentDateTime()}
                    </div>
                `;
                
                // êµì²´ ì¼ì ì •ë³´ ì¶”ê°€
                const replaceDateHTML = `
                    <div class="mt-2 text-xs text-[#6C757D]">
                        êµì²´ ì¼ì: ${data.lastReplaced} | í‰ê·  ì†Œëª¨ìœ¨: ${data.avgConsumption}%
                    </div>
                `;
                
                statusContainer.querySelector('.flex-1').innerHTML = `
                    <h4 class="text-base font-semibold text-[#1A1C20]">${typeName}</h4>
                    ${statusHTML}
                    ${replaceDateHTML}
                `;
            }
            
            // ì…ë ¥ í•„ë“œ ê°’ë„ ì—…ë°ì´íŠ¸ (ì‹œê°ì  í™•ì¸)
            const lastReplacedInput = document.getElementById(`lastReplaced-${typeId}`);
            const remainingInput = document.getElementById(`remaining-${typeId}`);
            const avgConsumptionInput = document.getElementById(`avgConsumption-${typeId}`);
            
            if (lastReplacedInput) lastReplacedInput.value = data.lastReplaced;
            if (remainingInput) remainingInput.value = data.remaining;
            if (avgConsumptionInput) avgConsumptionInput.value = data.avgConsumption;
        }

        // ì „ì²´ ì†Œëª¨í’ˆ ì €ì¥
        function saveAllConsumables() {
            const consumables = consumablesByModel[currentModelName] || [];
            const formData = [];
            let hasError = false;
            let errorMessage = '';

            consumables.forEach(item => {
                const lastReplaced = document.getElementById(`lastReplaced-${item.typeId}`)?.value;
                const remaining = document.getElementById(`remaining-${item.typeId}`)?.value;
                const avgConsumption = document.getElementById(`avgConsumption-${item.typeId}`)?.value;

                if (!lastReplaced || remaining === '' || avgConsumption === '') {
                    hasError = true;
                    errorMessage = `${item.type}: êµì²´ ì¼ì, ì”ëŸ‰, í‰ê·  ì†Œëª¨ìœ¨ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.`;
                    return;
                }

                formData.push({
                    typeId: item.typeId,
                    type: item.type,
                    lastReplaced: lastReplaced,
                    remaining: parseFloat(remaining),
                    avgConsumption: parseFloat(avgConsumption)
                });
            });

            if (hasError) {
                showToast('error', errorMessage);
                return;
            }

            console.log('ì „ì²´ ì €ì¥ë  ë°ì´í„°:', formData);
            showToast('success', 'ëª¨ë“  ì†Œëª¨í’ˆ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì´ë ¥ ëª¨ë‹¬ ì—´ê¸°
        // ì´ë ¥ ëª¨ë‹¬ ì´ˆê¸°í™” ë° ì²« í˜ì´ì§€ ë¡œë“œ
        function openHistoryModal(consumableName, typeId) {
            currentHistoryPage = 1; // í˜ì´ì§€ ì´ˆê¸°í™”
            loadHistoryPage(consumableName, typeId);
        }

        // í˜ì´ì§€ ë³€ê²½
        function changeHistoryPage(page) {
            if (page < 1) return;
            const consumableName = document.getElementById('historyModalSubtitle').textContent.split(' - ')[0];
            const typeId = findTypeIdByConsumableName(consumableName);
            currentHistoryPage = page;
            loadHistoryPage(consumableName, typeId);
        }

        // íƒ€ì… ID ì°¾ê¸°
        function findTypeIdByConsumableName(consumableName) {
            const consumables = consumablesByModel[currentModelName] || [];
            const found = consumables.find(item => item.type === consumableName);
            return found ? found.typeId : '';
        }

        // ì´ë ¥ í˜ì´ì§€ ë¡œë“œ
        function loadHistoryPage(consumableName, typeId) {
            document.getElementById('historyModalSubtitle').innerHTML = `
                <p>ë¡œë´‡: ${currentRobotName}</p>
                <p>ì†Œëª¨í’ˆ: ${consumableName}</p>
            `;
            
            // ì†Œëª¨í’ˆë³„ ìƒ˜í”Œ ì´ë ¥ ë°ì´í„° (ìµœëŒ€ 15ê°œ)
            const historyDataByType = {
                'brush-main': [
                    { recordedAt: '2024-10-15 14:30:00', replacedDate: '2024-10-01', remaining: 75, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-14 14:30:00', replacedDate: '2024-10-01', remaining: 76, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-13 14:30:00', replacedDate: '2024-10-01', remaining: 77, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-12 14:30:00', replacedDate: '2024-10-01', remaining: 78, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-11 14:30:00', replacedDate: '2024-10-01', remaining: 79, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-10 10:15:00', replacedDate: '2024-10-01', remaining: 85, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-09 10:15:00', replacedDate: '2024-10-01', remaining: 86, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-08 10:15:00', replacedDate: '2024-10-01', remaining: 87, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-07 10:15:00', replacedDate: '2024-10-01', remaining: 88, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-06 10:15:00', replacedDate: '2024-10-01', remaining: 89, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-05 09:00:00', replacedDate: '2024-10-01', remaining: 95, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-04 09:00:00', replacedDate: '2024-10-01', remaining: 96, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-03 09:00:00', replacedDate: '2024-10-01', remaining: 97, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-02 09:00:00', replacedDate: '2024-10-01', remaining: 98, avgConsumption: 0.0020 },
                    { recordedAt: '2024-10-01 14:00:00', replacedDate: '2024-10-01', remaining: 100, avgConsumption: 0.0020 }
                ],
                'brush-side': [
                    { recordedAt: '2024-10-15 14:30:00', replacedDate: '2024-09-10', remaining: 82, avgConsumption: 0.0018 },
                    { recordedAt: '2024-10-10 10:15:00', replacedDate: '2024-09-10', remaining: 87, avgConsumption: 0.0018 },
                    { recordedAt: '2024-10-05 09:00:00', replacedDate: '2024-09-10', remaining: 92, avgConsumption: 0.0018 },
                    { recordedAt: '2024-09-10 14:00:00', replacedDate: '2024-09-10', remaining: 100, avgConsumption: 0.0018 }
                ],
                'filter-hepa': [
                    { recordedAt: '2024-10-15 14:30:00', replacedDate: '2024-09-20', remaining: 88, avgConsumption: 0.0025 },
                    { recordedAt: '2024-10-10 10:15:00', replacedDate: '2024-09-20', remaining: 90, avgConsumption: 0.0025 },
                    { recordedAt: '2024-10-05 09:00:00', replacedDate: '2024-09-20', remaining: 92, avgConsumption: 0.0025 },
                    { recordedAt: '2024-09-20 14:00:00', replacedDate: '2024-09-20', remaining: 100, avgConsumption: 0.0025 }
                ],
                'filter-dust': [
                    { recordedAt: '2024-10-15 14:30:00', replacedDate: '2024-10-05', remaining: 78, avgConsumption: 0.0010 },
                    { recordedAt: '2024-10-10 10:15:00', replacedDate: '2024-10-05', remaining: 80, avgConsumption: 0.0010 },
                    { recordedAt: '2024-10-05 14:00:00', replacedDate: '2024-10-05', remaining: 100, avgConsumption: 0.0010 }
                ],
                'mop-pad': [
                    { recordedAt: '2024-10-15 14:30:00', replacedDate: '2024-10-10', remaining: 85, avgConsumption: 0.0008 },
                    { recordedAt: '2024-10-10 14:00:00', replacedDate: '2024-10-10', remaining: 100, avgConsumption: 0.0008 }
                ],
                'brush-standard': [],
                'filter-standard': []
            };

            // í˜„ì¬ ì†Œëª¨í’ˆì˜ ì„¤ì • ìƒíƒœ í™•ì¸
            const states = consumableStates[currentStateType] || {};
            const state = states[typeId] || {};
            const isConfigured = state.lastReplaced !== null && state.remaining !== null && state.avgConsumption !== null;
            
            // ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ë°°ì—´, ì„¤ì •ëœ ê²½ìš° ì´ë ¥ ë°ì´í„° ì‚¬ìš©
            const historyData = isConfigured ? (historyDataByType[typeId] || []) : [];
            const totalRecords = historyData.length;
            const itemsPerPage = 10; // í•œ í˜ì´ì§€ë‹¹ 10ê±´
            const startIndex = (currentHistoryPage - 1) * itemsPerPage;
            const endIndex = totalRecords > 0 ? Math.min(startIndex + itemsPerPage, totalRecords) : 0;
            const paginatedData = historyData.slice(startIndex, endIndex);
            const totalPages = Math.ceil(totalRecords / itemsPerPage);

            let historyHTML = '';
            if (totalRecords === 0) {
                historyHTML = `
                    <tr>
                        <td colspan="4" class="px-4 py-8 text-center text-sm text-[#6C757D]">
                            ì•„ì§ ì €ì¥ëœ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
            } else {
                historyHTML = paginatedData.map(item => `
                    <tr class="history-row border-b border-[#E9ECEF]">
                        <td class="px-4 py-3 text-sm text-[#1A1C20]">${item.recordedAt}</td>
                        <td class="px-4 py-3 text-sm text-[#1A1C20]">${item.replacedDate}</td>
                        <td class="px-4 py-3 text-sm text-[#1A1C20] text-right">${item.remaining}%</td>
                        <td class="px-4 py-3 text-sm text-[#1A1C20] text-right">${item.avgConsumption}%</td>
                    </tr>
                `).join('');
            }
            
            document.getElementById('historyTableBody').innerHTML = historyHTML;
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸ (ìµœëŒ€ 10ê°œ í‘œì‹œ)
            const paginationInfo = document.getElementById('paginationInfo');
            if (paginationInfo) {
                const infoText = paginationInfo.querySelector('div');
                if (infoText) {
                    const displayCount = totalRecords > 0 ? Math.min(paginatedData.length, itemsPerPage) : 0;
                    infoText.textContent = `ì´ ${totalRecords}ê±´ ì¤‘ ${totalRecords > 0 ? startIndex + 1 : 0}-${Math.min(startIndex + displayCount, totalRecords)}ê±´`;
                }
            }
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìƒì„± (10ê±´ ì´ˆê³¼ ì‹œì—ë§Œ 2í˜ì´ì§€ ì´ìƒ í‘œì‹œ)
            const paginationButtonsEl = document.getElementById('paginationButtons');
            if (paginationButtonsEl) {
                let buttonsHTML = '';
                
                if (totalPages > 1) {
                    // ì´ì „ ë²„íŠ¼
                    const prevDisabled = currentHistoryPage === 1 ? 'disabled' : '';
                    buttonsHTML += `<button onclick="changeHistoryPage(${currentHistoryPage - 1})" class="px-3 py-1 border border-[#CED4DA] rounded text-sm text-[#6C757D] hover:bg-[#F8F9FA]" ${prevDisabled}>ì´ì „</button>`;
                    
                    // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ (ìµœëŒ€ 5ê°œê¹Œì§€ í‘œì‹œ)
                    const maxVisiblePages = Math.min(totalPages, 5);
                    for (let i = 1; i <= maxVisiblePages; i++) {
                        buttonsHTML += `<button onclick="changeHistoryPage(${i})" class="px-3 py-1 ${i === currentHistoryPage ? 'bg-[#26C6DA] text-white' : 'border border-[#CED4DA] text-[#6C757D] hover:bg-[#F8F9FA]'} rounded text-sm">${i}</button>`;
                    }
                    
                    // ë‹¤ìŒ ë²„íŠ¼
                    const nextDisabled = currentHistoryPage === totalPages ? 'disabled' : '';
                    buttonsHTML += `<button onclick="changeHistoryPage(${currentHistoryPage + 1})" class="px-3 py-1 border border-[#CED4DA] rounded text-sm text-[#6C757D] hover:bg-[#F8F9FA]" ${nextDisabled}>ë‹¤ìŒ</button>`;
                } else if (totalPages === 1 && totalRecords > 0) {
                    // 1í˜ì´ì§€ë§Œ ìˆëŠ” ê²½ìš°
                    buttonsHTML += `<button class="px-3 py-1 bg-[#26C6DA] text-white rounded text-sm">1</button>`;
                }
                
                paginationButtonsEl.innerHTML = buttonsHTML;
            }
            
            document.getElementById('historyModal').classList.remove('hidden');
            document.getElementById('historyModal').classList.add('flex');
        }

        // ì´ë ¥ ëª¨ë‹¬ ë‹«ê¸°
        function closeHistoryModal() {
            document.getElementById('historyModal').classList.add('hidden');
            document.getElementById('historyModal').classList.remove('flex');
        }

        // ìƒíƒœ í´ë˜ìŠ¤ ë°˜í™˜
        function getStatusClass(status) {
            const classes = {
                'replace': 'bg-[#F8D7DA] text-[#721C24]',
                'warning': 'bg-[#FFF3CD] text-[#856404]',
                'normal': 'bg-[#D4EDDA] text-[#155724]'
            };
            return classes[status] || '';
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getStatusText(status) {
            const texts = {
                'replace': 'êµì²´ í•„ìš”',
                'warning': 'ì£¼ì˜',
                'normal': 'ì •ìƒ'
            };
            return texts[status] || '';
        }

        // í˜„ì¬ ë‚ ì§œì‹œê°„ ë°˜í™˜
        function getCurrentDateTime() {
            const now = new Date();
            return now.toLocaleString('ko-KR', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }



        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showToast(type, message) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const messageEl = document.getElementById('toastMessage');

            const icons = {
                'success': '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'error': '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'warning': '<svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',
                'info': '<svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
            };

            icon.innerHTML = icons[type] || icons['success'];
            messageEl.textContent = message;

            toast.classList.remove('hidden');

            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼ ìˆ¨ê¸°ê¸°
        function hideToast() {
            document.getElementById('toast').classList.add('hidden');
        }

        // ë¡œë´‡ ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('robotSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#robotTableBody tr');

            rows.forEach(row => {
                const robotName = row.cells[3].textContent.toLowerCase();
                if (robotName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // ì‚¬ì´íŠ¸ ì„ íƒ í•„í„°
        document.getElementById('siteSelect').addEventListener('change', function(e) {
            const selectedSite = e.target.value;
            const rows = document.querySelectorAll('#robotTableBody tr');

            rows.forEach(row => {
                const siteName = row.cells[1].textContent;
                
                if (selectedSite === 'all') {
                    row.style.display = '';
                } else {
                    const siteValue = e.target.options[e.target.selectedIndex].text;
                    if (siteName === siteValue) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        });

        // ì´ë ¥ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('historyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHistoryModal();
            }
        });
    </script>
</body>
</html>

